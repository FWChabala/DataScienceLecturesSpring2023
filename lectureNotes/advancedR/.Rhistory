knitr::opts_chunk$set(echo = TRUE)
suppressPackageStartupMessages({
library(SummarizedExperiment)
library(TBSignatureProfiler)
library(DESeq2)
library(Rtsne)
library(umap)
library(ggplot2)
library(limma)
library(DT)
library(ComplexHeatmap)
})
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
suppressPackageStartupMessages({
library(SummarizedExperiment)
library(TBSignatureProfiler)
library(DESeq2)
library(Rtsne)
library(umap)
library(ggplot2)
library(limma)
library(DT)
library(ComplexHeatmap)
})
# Chunk 2: Load Data
# Read in the data
counts <- read.csv("~/Dropbox/projects/nanostring_analysis/Analysis_2/T023_S024_RawData_Filtered_DataOnly.csv", header=T,row.names=1)
coldata <- read.table("~/Dropbox/projects/nanostring_analysis/meta_data_all.txt", header=T, row.names=1)
# Fix EXCEL renaming of SEPT4!!
rownames(counts)[rownames(counts)=="Sep-04"] = "SEPT4"
# reorder Levels of TB_status so TB shows up first in plots
coldata$TB_status = factor(coldata$TB_status, levels=c("TB","LTBI"))
# reorder the counts to match the coldata
counts <- counts[,match(rownames(coldata),colnames(counts))]
## create a SummarizedExperiment
nano_data_all<- SummarizedExperiment(assays=list(counts=as.matrix(counts[1:107,])),
colData = coldata)
# Make a logcounts, CPM and log_cpm assay
nano_data_all <- mkAssay(nano_data_all, log = TRUE, counts_to_CPM = TRUE)
### As of 4/2021: remove parasites per request of the reviewers--set all parasite analyses below as eval=F
nano_data_all <- nano_data_all[,!(colData(nano_data_all)$Parasites=="Yes")]
## notice that we have 4 assays now
#assays(nano_data_all)
# now define as SE with no comorbs
nano_data_nocomorbs = nano_data_all[,c(1:179)]
## write to file
#saveRDS(nano_data_all,file="nano_data_all.rds")
# Chunk 3
colData(nano_data_all)$TB_LTBI <- colData(nano_data_all)$TB_status
levels(colData(nano_data_all)$TB_status) <- c("TB", "LTBI", "LTBI_Alcohol", "LTBI_Diabetes", "LTBI_Malnourished", "LTBI_Pregnant") ## , "LTBI_Parasites")
colData(nano_data_all)$TB_status[colData(nano_data_all)$Alcohol=="Yes"]="LTBI_Alcohol"
colData(nano_data_all)$TB_status[colData(nano_data_all)$Diabetes=="Yes"]="LTBI_Diabetes"
colData(nano_data_all)$TB_status[colData(nano_data_all)$Malnourished=="Yes"]="LTBI_Malnourished"
colData(nano_data_all)$TB_status[colData(nano_data_all)$Pregnant=="Yes"]="LTBI_Pregnant"
#colData(nano_data_all)$TB_status[colData(nano_data_all)$Parasites=="Yes"]="LTBI_Parasites"
# Chunk 4
nano_data_ltbi = nano_data_all[,colData(nano_data_all)$TB_status != "TB"]
colData(nano_data_ltbi)$TB_status = factor(colData(nano_data_ltbi)$TB_status, levels=c("LTBI", "LTBI_Alcohol", "LTBI_Diabetes", "LTBI_Malnourished", "LTBI_Pregnant")) # , "LTBI_Parasites"))
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
suppressPackageStartupMessages({
library(SummarizedExperiment)
library(TBSignatureProfiler)
library(DESeq2)
library(Rtsne)
library(umap)
library(ggplot2)
library(limma)
library(DT)
library(ComplexHeatmap)
})
# Chunk 2: Load Data
# Read in the data
counts <- read.csv("~/Dropbox/projects/nanostring_analysis/Analysis_2/T023_S024_RawData_Filtered_DataOnly.csv", header=T,row.names=1)
coldata <- read.table("~/Dropbox/projects/nanostring_analysis/meta_data_all.txt", header=T, row.names=1)
# Fix EXCEL renaming of SEPT4!!
rownames(counts)[rownames(counts)=="Sep-04"] = "SEPT4"
# reorder Levels of TB_status so TB shows up first in plots
coldata$TB_status = factor(coldata$TB_status, levels=c("TB","LTBI"))
# reorder the counts to match the coldata
counts <- counts[,match(rownames(coldata),colnames(counts))]
## create a SummarizedExperiment
nano_data_all<- SummarizedExperiment(assays=list(counts=as.matrix(counts[1:107,])),
colData = coldata)
# Make a logcounts, CPM and log_cpm assay
nano_data_all <- mkAssay(nano_data_all, log = TRUE, counts_to_CPM = TRUE)
### As of 4/2021: remove parasites per request of the reviewers--set all parasite analyses below as eval=F
nano_data_all <- nano_data_all[,!(colData(nano_data_all)$Parasites=="Yes")]
## notice that we have 4 assays now
#assays(nano_data_all)
# now define as SE with no comorbs
nano_data_nocomorbs = nano_data_all[,c(1:179)]
## write to file
#saveRDS(nano_data_all,file="nano_data_all.rds")
# Chunk 3
colData(nano_data_all)$TB_LTBI <- colData(nano_data_all)$TB_status
levels(colData(nano_data_all)$TB_status) <- c("TB", "LTBI", "LTBI_Alcohol", "LTBI_Diabetes", "LTBI_Malnourished", "LTBI_Pregnant") ## , "LTBI_Parasites")
colData(nano_data_all)$TB_status[colData(nano_data_all)$Alcohol=="Yes"]="LTBI_Alcohol"
colData(nano_data_all)$TB_status[colData(nano_data_all)$Diabetes=="Yes"]="LTBI_Diabetes"
colData(nano_data_all)$TB_status[colData(nano_data_all)$Malnourished=="Yes"]="LTBI_Malnourished"
colData(nano_data_all)$TB_status[colData(nano_data_all)$Pregnant=="Yes"]="LTBI_Pregnant"
#colData(nano_data_all)$TB_status[colData(nano_data_all)$Parasites=="Yes"]="LTBI_Parasites"
# Chunk 4
nano_data_ltbi = nano_data_all[,colData(nano_data_all)$TB_status != "TB"]
colData(nano_data_ltbi)$TB_status = factor(colData(nano_data_ltbi)$TB_status, levels=c("LTBI", "LTBI_Alcohol", "LTBI_Diabetes", "LTBI_Malnourished", "LTBI_Pregnant")) # , "LTBI_Parasites"))
